<head>
	<style>
		body {
			margin: 0;
		}
	</style>
	<script src="https://unpkg.com/d3-array"></script>
	<script src="https://unpkg.com/d3-scale"></script>
	<script src="https://unpkg.com/d3-dsv"></script>
	<script src="https://unpkg.com/globe.gl"></script>
	<body>
		<div>
			<label for="startYear">Start Year:</label>
			<input
				type="number"
				id="startYear"
				min="1971"
				max="1979"
				step="1"
				value="1971"
			/>
			<label for="endYear">End Year:</label>
			<input
				type="number"
				id="endYear"
				min="1971"
				max="1979"
				step="1"
				value="1979"
			/>
			<button onclick="filterAndDisplayData()">Filter Data</button>
		</div>
		<div id="globeViz"></div>
		<script>
			const colorScale = d3.scaleOrdinal([
				"orangered",
				"orange",
				"limegreen",
				"cyan",
				"magenta",
				"pink",
			]);

			const elem = document.getElementById("globeViz");
			const moon = Globe()
				.globeImageUrl("./resources/moon.tif")
				.backgroundImageUrl("./resources/background.png")
				.showGraticules(true)
				.showAtmosphere(false)
				.ringColor(() => "yellow")
				.ringMaxRadius("Magnitude")
				.ringPropagationSpeed(0.5)
				.ringRepeatPeriod(1000)
				.labelText("label")
				.labelSize(1)
				.labelDotRadius(0.5)
				.labelDotOrientation("top")
				.labelColor((d) => colorScale(d.label))
				.labelLabel(
					(d) => `
        <div><h3>${d.label}</h3></div>
        <div>Program: <b>${d.program}</b></div>
        <div>Longitude: <b>${d.lng}</b></div>
        <div>Latitude: <b>${d.lat}</b></div>
        <div>Date: <b>${d.date}</b></div>
        <div>Agency: <b>${d.agency}</b></div>
      `)
				.onLabelClick((d) => window.open(d.url, "_blank"))(elem);

			fetch("./resources/apollo_missions.json")
				.then((r) => r.json())
				.then((stations) => {
					moon.labelsData(stations);
				});

			function filterAndDisplayData() {
				const startYear = document.getElementById("startYear").value;
				const endYear = document.getElementById("endYear").value;

				const startDate = new Date(`${startYear}-01-01T00:00:00Z`);
				const endDate = new Date(`${endYear}-12-31T23:59:59Z`);

				fetch("./resources/nakamura_1979_sm_locations.json")
					.then((r) => r.json())
					.then((moonquakes) => {
						const filteredData = moonquakes.filter((d) => {
							const date = new Date(d.date);
							return date >= startDate && date <= endDate;
						});

						moon.ringsData(filteredData);
					});
			}
		</script>
	</body>
</head>
